/*
 * Wazuh Vulnerability scanner - Database Feed Manager
 * Copyright (C) 2015, Wazuh Inc.
 * Feb 28, 2023.
 *
 * This program is free software; you can redistribute it
 * and/or modify it under the terms of the GNU General Public
 * License (version 2) as published by the FSF - Free Software
 * Foundation.
 */

#ifndef _GLOBALDATA_HPP
#define _GLOBALDATA_HPP

#include "json.hpp"
#include "singleton.hpp"
#include <mutex>
#include <shared_mutex>

/**
 * @brief Class to manage global maps data.
 */
class GlobalData final : public Singleton<GlobalData>
{
    mutable std::shared_mutex m_mutex;
    nlohmann::json m_vendorMaps;
    nlohmann::json m_osCpeMaps;
    nlohmann::json m_cnaMappings;
    std::string m_managerName;

public:
    /**
     * @brief Set vendor map data.
     * @param vendor Vendor data.
     */
    void vendorMaps(const nlohmann::json& vendor)
    {
        std::unique_lock lock(m_mutex);
        m_vendorMaps = vendor;
    }

    /**
     * @brief Set OS CPE map data.
     * @param osCpe OS CPE data.
     */
    void osCpeMaps(const nlohmann::json& osCpe)
    {
        std::unique_lock lock(m_mutex);
        m_osCpeMaps = osCpe;
    }

    /**
     * @brief Set manager name.
     * @param name Manager name.
     */
    void managerName(std::string_view name)
    {
        std::unique_lock lock(m_mutex);
        m_managerName = name;
    }

    /**
     * @brief Set CNA mappings.
     * @param cnaMappings CNA mappings.
     */
    void cnaMappings(const nlohmann::json& cnaMappings)
    {
        std::unique_lock lock(m_mutex);
        m_cnaMappings = cnaMappings;
    }

    /**
     * @brief Get vendor map data.
     * @return vendor map data.
     */
    nlohmann::json vendorMaps() const
    {
        std::shared_lock lock(m_mutex);
        return m_vendorMaps;
    }

    /**
     * @brief Get OS CPE map data.
     * @return OS CPE data.
     */
    nlohmann::json osCpeMaps() const
    {
        std::shared_lock lock(m_mutex);
        return m_osCpeMaps;
    }

    /**
     * @brief Get CNA mappings.
     * @return CNA mappings.
     */
    nlohmann::json cnaMappings() const
    {
        std::shared_lock lock(m_mutex);
        return m_cnaMappings;
    }

    /**
     * @brief Get manager name.
     * @return Manager name.
     */
    std::string managerName() const
    {
        std::shared_lock lock(m_mutex);
        return m_managerName.empty() ? "manager" : m_managerName;
    }
};

#endif // _GLOBALDATA_HPP
