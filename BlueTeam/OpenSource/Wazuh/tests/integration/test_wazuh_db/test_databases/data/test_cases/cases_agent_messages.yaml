- name: "Syscollector deltas messages - miscellaneous"
  description: Test successfull and err while dealing with deltas
  configuration_parameters:
  metadata:
    test_case:
    - input: agent 001 dbsync this_table_doesnot_exist test NULL
      output: err
      stage: invalid table.
    - input: agent 001 dbsync
      output: err Invalid DB query syntax, near 'dbsync'
      stage: missing table.
    - input: agent 001 dbsync ports
      output: err Invalid dbsync query syntax, near 'ports'
      stage: missing operation.
    - input: agent 001 dbsync ports CUSTOMOPERATION
      output: err Invalid dbsync query syntax, near 'ports'
      stage: invalid operation.

- name: "Syscollector deltas messages - ports"
  description: Test successfull and err while dealing with ports deltas
  configuration_parameters:
  metadata:
    test_case:
    - input: >-
        agent 001 dbsync ports INSERTED {"checksum":"eff13e52290143eb5b5b9b8c191902609f37c713","inode":494908,
        "item_id":"e2c92964ad145a635139f6318057506e386e00a3","local_ip":"0.0.0.0","local_port":34340,"pid":0,
        "process":null,"protocol":"tcp","remote_ip":"0.0.0.0","remote_port":0,"rx_queue":1,
        "scan_time":"2021/10/13 14:40:03","state":"listening","tx_queue":1}
      output: 'ok '
      stage: insert port.
    - input: >-
        agent 001 dbsync ports INSERTED {"checksum":"eff13e52290143eb5b5b9b8c191902609f37c713","inode":494908,
        "item_id":"e2c92964ad145a635139f6318057506e386e00a3","local_ip":"0.0.0.0","local_port":34340,"pid":0,
        "process":null,"protocol":"tcp","remote_ip":"0.0.0.0","remote_port":0,"rx_queue":1,
        "scan_time":"2021/10/13 14:40:03","state":"listening","tx_queue":1}
      output: 'ok '
      stage: insert duplicated port.
    - input: >-
        agent 001 dbsync ports INSERTED {"checksum":"eff13e52290143eb5b5b9b8c191902609f37c713",
        "item_id":"e2c92964ad145a635139f6318057506e386e00a3","local_ip":"0.0.0.0","local_port":34340,"pid":0,
        "process":null,"protocol":"tcp","remote_ip":"0.0.0.0","remote_port":0,"rx_queue":1,
        "scan_time":"2021/10/13 14:40:03","state":"listening","tx_queue":1}
      output: 'ok '
      stage: insert port without PK.
    - input: >-
        agent 001 dbsync ports MODIFIED {"checksum":"eff13e52290143eb5b5b9b8c191902609f123456","inode":494908,
        "item_id":"e2c92964ad145a635139f6318057506e386e00a3","local_ip":"0.0.0.0","local_port":34340,"pid":0,
        "process":null,"protocol":"tcp","remote_ip":"0.0.0.0","remote_port":0,"rx_queue":1,
        "scan_time":"2021/10/13 14:50:03","state":"listening","tx_queue":1}
      output: 'ok '
      stage: modify port.
    - input: >-
        agent 001 dbsync ports MODIFIED {"checksum":"eff13e52290143eb5b5b9b8c191902609f123456","inode":494908,
        "item_id":"e2c92964ad145a635139f6318057506e386e00a3","local_ip":"0.0.0.0","local_port":34340,"pid":0,
        "process":"NULL","protocol":"tcp","remote_ip":"0.0.0.0","remote_port":0,"rx_queue":1,
        "scan_time":"2021/10/13 14:50:03","state":"listening","tx_queue":1}
      output: 'ok '
      stage: modify port from value to NULL string.
    - input: >-
        agent 001 dbsync ports MODIFIED {"checksum":"eff13e52290143eb5b5b9b8c191902609f123456",
        "item_id":"e2c92964ad145a635139f6318057506e386e00a3","local_ip":"0.0.0.0","local_port":34340,"pid":0,
        "process":"NULL","protocol":"tcp","remote_ip":"0.0.0.0","remote_port":0,"rx_queue":1,
        "scan_time":"2021/10/13 14:50:03","state":"listening","tx_queue":1}
      output: 'ok '
      stage: modify port without enough fields (PKs).
    - input: >-
        agent 001 dbsync ports MODIFIED {"checksum":"eff13e52290143eb5b5b9b8c191902609f37c713","inode":12345,
        "item_id":"e2c92964ad145a635139f6318057506e386e00a3","local_ip":"0.0.0.0","local_port":34340,"pid":0,
        "process":null,"protocol":"tcp","remote_ip":"0.0.0.0","remote_port":0,"rx_queue":1,
        "scan_time":"2021/10/13 14:40:03","state":"listening","tx_queue":1}
      output: 'ok '
      stage: modify nonexistent port (will be treated as an insertion).
    - input: >-
        agent 001 dbsync ports MODIFIED {"checksum":"eff13e52290143eb5b5b9b8c191902609f37c713","inode":["12345"],
        "item_id":"e2c92964ad145a635139f6318057506e386e00a3","local_ip":"0.0.0.0","local_port":34340,"pid":0,
        "process":null,"protocol":"tcp","remote_ip":"0.0.0.0","remote_port":0,"rx_queue":1,
        "scan_time":"2021/10/13 14:40:03","state":"listening","tx_queue":1}
      output: err
      stage: modify port with invalid field type.
    - input: >-
        agent 001 dbsync ports DELETED {"checksum":"eff13e52290143eb5b5b9b8c191902609f37c713",
        "item_id":"e2c92964ad145a635139f6318057506e386e00a3","local_ip":"0.0.0.0","local_port":34340,"pid":0,
        "process":null,"protocol":"tcp","remote_ip":"0.0.0.0","remote_port":0,"rx_queue":1,
        "scan_time":"2021/10/13 14:40:03","state":"listening","tx_queue":1}
      output: 'ok '
      stage: delete port without enough fields (PKs).
    - input: >-
        agent 001 dbsync ports DELETED {"checksum":"eff13e52290143eb5b5b9b8c191902609f37c713","inode":494908,
        "item_id":"e2c92964ad145a635139f6318057506e386e00a3","local_ip":"0.0.0.0","local_port":34340,"pid":0,
        "process":null,"protocol":"tcp","remote_ip":"0.0.0.0","remote_port":0,"rx_queue":1,
        "scan_time":"2021/10/13 14:40:03","state":"listening","tx_queue":1}
      output: 'ok '
      stage: delete port.
    - input: >-
        agent 001 dbsync ports DELETED {"checksum":"eff13e52290143eb5b5b9b8c191902609f37c713","inode":494908,
        "item_id":"e2c92964ad145a635139f6318057506e386e00a3","local_ip":"0.0.0.0","local_port":34340,"pid":0,
        "process":null,"protocol":"tcp","remote_ip":"0.0.0.0","remote_port":0,"rx_queue":1,
        "scan_time":"2021/10/13 14:40:03","state":"listening","tx_queue":1}
      output: 'ok '
      stage: delete already deleted port.

- name: "Syscollector deltas messages - processes"
  description: Test successfull and err while dealing with processes deltas
  configuration_parameters:
  metadata:
    test_case:
    - input: >-
        agent 001 dbsync processes INSERTED {"argvs":"180","checksum":"343ed10dc637334a7400d01b8a28deb8db5cba28",
        "cmd":"","egroup":"root","euser":"root","fgroup":"root","name":"sleep","nice":0,"nlwp":1,"pgrp":116167,
        "pid":"156102","ppid":116169,"priority":20,"processor":3,"resident":129,"rgroup":"root","ruser":"root",
        "scan_time":"2021/10/13 14:57:07","session":116167,"sgroup":"root","share":114,"size":2019,
        "start_time":5799612,"state":"S","stime":0,"suser":"root","tgid":156102,"tty":0,"utime":0,"vm_size":8076}
      output: 'ok '
      stage: insert process.
    - input: >-
        agent 001 dbsync processes INSERTED {"argvs":"180","checksum":"343ed10dc637334a7400d01b8a28deb8db5cba28",
        "euser":"root","fgroup":"root","name":"sleep","nice":0,"nlwp":1,"pgrp":116167,"ppid":116169,
        "priority":20,"processor":3,"resident":129,"rgroup":"root","ruser":"root","scan_time":"2021/10/13 14:57:07",
        "session":116167,"sgroup":"root","share":114,"size":2019,"start_time":5799612,"state":"S","stime":0,
        "suser":"root","tgid":156102,"tty":0,"utime":0,"vm_size":8076,"cmd":"","egroup":"root"}
      output: 'ok '
      stage: insert process without enough fields.
    - input: >-
        agent 001 dbsync processes INSERTED {"argvs":"180","checksum":"343ed10dc637334a7400d01b8a28deb8db5cba28",
        "euser":"root","fgroup":"root","name":"sleep","nice":0,"nlwp":1,"pgrp":116167,"pid":"156102","ppid":116169,
        "priority":20,"processor":3,"resident":129,"rgroup":"root","ruser":"root","scan_time":"2021/10/13 14:57:07",
        "session":116167,"sgroup":"root","share":114,"size":2019,"start_time":5799612,"state":"S","stime":0,
        "suser":"root","tgid":156102,"tty":0,"utime":0,"vm_size":8076,"cmd":"","egroup":"root"}
      output: 'ok '
      stage: insert duplicated process.
    - input: >-
        agent 001 dbsync processes INSERTED {"argvs":"180","checksum":"343ed10dc637334a7400d01b8a28deb8db5cba28",
        "euser":"root","fgroup":"root","name":"sleep","nice":0,"nlwp":1,"pgrp":116167,"pid":"156102",
        "priority":20,"processor":3,"resident":129,"rgroup":"root","ruser":"root","scan_time":"2021/10/13 14:57:07",
        "session":116167,"sgroup":"root","share":114,"size":2019,"start_time":5799612,"state":"S","stime":0,
        "suser":"root","tgid":156102,"tty":0,"utime":0,"vm_size":8076,"cmd":"","egroup":"root","ppid":"116169test"}
      output: err
      stage: insert process with invalid field type.
    - input: >-
        agent 001 dbsync processes MODIFIED {"argvs":"180","checksum":"343ed10dc637334a7400d01b8a28deb8db5cba28",
        "euser":"root","fgroup":"root","name":"sleep","nice":0,"nlwp":1,"pgrp":116167,"pid":"156102","ppid":116169,
        "priority":20,"processor":7,"resident":129,"rgroup":"root","ruser":"root","scan_time":"2021/10/13 14:57:07",
        "session":116167,"sgroup":"root","share":114,"size":2019,"start_time":5799612,"state":"S","stime":0,
        "suser":"root","tgid":156102,"tty":0,"utime":0,"vm_size":10000,"cmd":"","egroup":"root"}
      output: 'ok '
      stage: modify process.
    - input: >-
        agent 001 dbsync processes MODIFIED {"argvs":"180","checksum":"343ed10dc637334a7400d01b8a28deb8db5cba28",
        "euser":"root","fgroup":"root","name":"sleep","nice":0,"nlwp":1,"pgrp":116167,"pid":"156102","ppid":116169,
        "priority":20,"processor":7test,"resident":129,"rgroup":"root","scan_time":"2021/10/13 14:57:07",
        "session":116167,"sgroup":"root","share":114,"size":2019,"start_time":5799612,"state":"S","stime":0,
        "suser":"root","tgid":156102,"tty":0,"utime":0,"vm_size":10000,"cmd":"","egroup":"root","ruser":"root"}
      output: err
      stage: modify process with invalid field type.
    - input: >-
        agent 001 dbsync processes MODIFIED {"argvs":"180","checksum":"343ed10dc637334a7400d01b8a28deb8db5cba28",
        "euser":"root","fgroup":"root","name":"sleep","nice":0,"nlwp":1,"pgrp":116167,"ppid":116169,
        "priority":20,"processor":7,"resident":129,"rgroup":"root","scan_time":"2021/10/13 14:57:07",
        "session":116167,"sgroup":"root","share":114,"size":2019,"start_time":5799612,"state":"S","stime":0,
        "suser":"root","tgid":156102,"tty":0,"utime":0,"vm_size":10000,"cmd":"","egroup":"root","ruser":"root"}
      output: 'ok '
      stage: modify process without enough fields.
    - input: >-
        agent 001 dbsync processes MODIFIED {"argvs":"180","checksum":"343ed10dc637334a7400d01b8a28deb8db5cba28",
        "euser":"root","fgroup":"root","name":"sleep","nice":0,"nlwp":1,"pgrp":116167,"pid":"12345","ppid":116169,
        "priority":20,"processor":7,"resident":129,"rgroup":"root","ruser":"root","scan_time":"2021/10/13 14:57:07",
        "session":116167,"sgroup":"root","share":114,"size":2019,"start_time":5799612,"state":"S","stime":0,
        "suser":"root","tgid":156102,"tty":0,"utime":0,"vm_size":10000,"cmd":"","egroup":"root"}
      output: 'ok '
      stage: modify nonexistent process.
    - input: >-
        agent 001 dbsync processes DELETED {"argvs":"180","checksum":"343ed10dc637334a7400d01b8a28deb8db5cba28",
        "euser":"root","fgroup":"root","name":"sleep","nice":0,"nlwp":1,"pgrp":116167,"ppid":116169,
        "priority":20,"processor":7,"resident":129,"rgroup":"root","ruser":"root","scan_time":"2021/10/13 14:57:07",
        "session":116167,"sgroup":"root","share":114,"size":2019,"start_time":5799612,"state":"S","stime":0,
        "suser":"root","tgid":156102,"tty":0,"utime":0,"vm_size":10000,"cmd":"","egroup":"root"}
      output: 'ok '
      stage: delete process without enough fields.
    - input: >-
        agent 001 dbsync processes DELETED {"argvs":"180","checksum":"343ed10dc637334a7400d01b8a28deb8db5cba28",
        "euser":"root","fgroup":"root","name":"sleep","nice":0,"nlwp":1,"pgrp":116167,"pid":"12345","ppid":116169,
        "priority":20,"processor":7,"resident":129,"rgroup":"root","ruser":"root","scan_time":"2021/10/13 14:57:07",
        "session":116167,"sgroup":"root","share":114,"size":2019,"start_time":5799612,"state":"S","stime":0,
        "suser":"root","tgid":156102,"tty":0,"utime":0,"vm_size":10000,"cmd":"","egroup":"root"}
      output: 'ok '
      stage: delete process.
    - input: >-
        agent 001 dbsync processes DELETED {"argvs":"180","checksum":"343ed10dc637334a7400d01b8a28deb8db5cba28",
        "euser":"root","fgroup":"root","name":"sleep","nice":0,"nlwp":1,"pgrp":116167,"pid":"12345","ppid":116169,
        "priority":20,"processor":7,"resident":129,"rgroup":"root","ruser":"root","scan_time":"2021/10/13 14:57:07",
        "session":116167,"sgroup":"root","share":114,"size":2019,"start_time":5799612,"state":"S","stime":0,
        "suser":"root","tgid":156102,"tty":0,"utime":0,"vm_size":10000,"cmd":"","egroup":"root"}
      output: 'ok '
      stage: delete already deleted process.

- name: "Syscollector deltas messages - packages"
  description: Test successfull and err while dealing with packages deltas
  configuration_parameters:
  metadata:
    test_case:
    - input: >-
        agent 001 dbsync packages INSERTED {"checksum":"1c1bf8bbc20caef77010f960461cc20fb9c67568",
        "architecture":"amd64","description":"Qt 5 OpenGL module","format":"deb","groups":"libs","location":" ",
        "item_id":"caa4868d177fbebc5b145a2a92497ebcf566838a","multiarch":"same","name":"libqt5opengl5",
        "priority":"optional","scan_time":"2021/10/13 15:10:49","size":572,"source":"qtbase-opensource-src",
        "vendor":"Ubuntu Developers <ubuntu-devel-discuss@lists.ubuntu.com>","version":"5.12.8+dfsg-0ubuntu1"}
      output: 'ok '
      stage: insert package.
    - input: >-
        agent 001 dbsync packages INSERTED {"checksum":"1c1bf8bbc20caef77010f960461cc20fb9c67568",
        "architecture":"amd64","description":"Qt 5 OpenGL module","format":"deb","groups":"libs",
        "item_id":"caa4868d177fbebc5b145a2a92497ebcf566838a","multiarch":"same",
        "priority":"optional","scan_time":"2021/10/13 15:10:49","size":572,"source":"qtbase-opensource-src",
        "vendor":"Ubuntu Developers <ubuntu-devel-discuss@lists.ubuntu.com>","version":"5.12.8+dfsg-0ubuntu1"}
      output: 'ok '
      stage: insert package without enough fields.
    - input: >-
        agent 001 dbsync packages INSERTED {"checksum":"1c1bf8bbc20caef77010f960461cc20fb9c67568",
        "architecture":"amd64","description":"Qt 5 OpenGL module","format":"deb","groups":"libs","location":" ",
        "item_id":"caa4868d177fbebc5b145a2a92497ebcf566838a","multiarch":"same","name":"libqt5opengl5",
        "priority":"optional","scan_time":"2021/10/13 15:10:49","size":572,"source":"qtbase-opensource-src",
        "vendor":"Ubuntu Developers <ubuntu-devel-discuss@lists.ubuntu.com>","version":"5.12.8+dfsg-0ubuntu1"}
      output: 'ok '
      stage: insert duplicated package.
    - input: >-
        agent 001 dbsync packages INSERTED {"checksum":"1c1bf8bbc20caef77010f960461cc20fb9c67568",
        "architecture":"amd64","description":"Qt 5 OpenGL module","format":"deb","groups":"libs",
        "item_id":"caa4868d177fbebc5b145a2a92497ebcf566838a","multiarch":"same","name":"libqt5opengl5",
        "priority":"optional","scan_time":"2021/10/13 15:10:49","size":572MB,"source":"qtbase-opensource-src",
        "vendor":"Ubuntu Developers <ubuntu-devel-discuss@lists.ubuntu.com>","version":"5.12.8+dfsg-0ubuntu1"}
      output: err
      stage: insert package with invalid field type.
    - input: >-
        agent 001 dbsync packages MODIFIED {"checksum":"1c1bf8bbc20caef77010f960461cc20fb9c67568",
        "architecture":"amd64","description":"Qt 5 OpenGL module","format":"deb","groups":"extra","location":" ",
        "item_id":"caa4868d177fbebc5b145a2a92497ebcf566838a","multiarch":"same","name":"libqt5opengl5",
        "priority":"optional","scan_time":"2021/10/13 15:10:49","size":572,"source":"qtbase-opensource-src",
        "vendor":"Ubuntu Developers <ubuntu-devel-discuss@lists.ubuntu.com>","version":"5.12.8+dfsg-0ubuntu1"}
      output: 'ok '
      stage: modify package.
    - input: >-
        agent 001 dbsync packages MODIFIED {"checksum":"1c1bf8bbc20caef77010f960461cc20fb9c67568",
        "architecture":"amd64","description":"Qt 5 OpenGL module","format":"deb","groups":"libs",
        "item_id":"caa4868d177fbebc5b145a2a92497ebcf566838a","multiarch":"same","name":"libqt5opengl5",
        "priority":"optional","scan_time":"2021/10/13 15:10:49","size":572,"source":"qtbase-opensource-src",
        "vendor":"Ubuntu Developers <ubuntu-devel-discuss@lists.ubuntu.com>"}
      output: 'ok '
      stage: modify package without enough fields.
    - input: >-
        agent 001 dbsync packages MODIFIED {"checksum":"1c1bf8bbc20caef77010f960461cc20fb9c67568",
        "architecture":"amd64","description":"Qt 5 OpenGL module","format":"deb","groups":"libs","location":" ",
        "item_id":"caa4868d177fbebc5b145a2a92497ebcf566838a","multiarch":"same","name":"libqt5opengl5",
        "priority":"optional","scan_time":"2021/10/13 15:10:49","size":572,"source":"qtbase-opensource-src",
        "vendor":"Ubuntu Developers <ubuntu-devel-discuss@lists.ubuntu.com>","version":"5.12.8+dfsg-0ubuntu2"}
      output: 'ok '
      stage: modify nonexistent packages.
    - input: >-
        agent 001 dbsync packages MODIFIED {"checksum":"1c1bf8bbc20caef77010f960461cc20fb9c67568",
        "architecture":"amd64","description":"Qt 5 OpenGL module","format":"deb","groups":"libs",
        "item_id":"caa4868d177fbebc5b145a2a92497ebcf566838a","multiarch":"same","name":"libqt5opengl5",
        "priority":"optional","scan_time":"2021/10/13 15:10:49","size":572mb,"source":"qtbase-opensource-src",
        "vendor":"Ubuntu Developers <ubuntu-devel-discuss@lists.ubuntu.com>","version":"5.12.8+dfsg-0ubuntu1"}
      output: err
      stage: modify package with invalid field type.
    - input: >-
        agent 001 dbsync packages DELETED {"checksum":"1c1bf8bbc20caef77010f960461cc20fb9c67568",
        "description":"Qt 5 OpenGL module","format":"deb","groups":"libs",
        "item_id":"caa4868d177fbebc5b145a2a92497ebcf566838a","multiarch":"same","name":"libqt5opengl5",
        "priority":"optional","scan_time":"2021/10/13 15:10:49","size":572,"source":"qtbase-opensource-src",
        "vendor":"Ubuntu Developers <ubuntu-devel-discuss@lists.ubuntu.com>","version":"5.12.8+dfsg-0ubuntu1"}
      output: 'ok '
      stage: delete package without enough fields.
    - input: >-
        agent 001 dbsync packages DELETED {"checksum":"1c1bf8bbc20caef77010f960461cc20fb9c67568",
        "architecture":"amd64","description":"Qt 5 OpenGL module","format":"deb","groups":"libs",
        "item_id":"caa4868d177fbebc5b145a2a92497ebcf566838a","multiarch":"same","name":"libqt5opengl5",
        "priority":"optional","scan_time":"2021/10/13 15:10:49","size":572,"source":"qtbase-opensource-src",
        "vendor":"Ubuntu Developers <ubuntu-devel-discuss@lists.ubuntu.com>","version":"5.12.8+dfsg-0ubuntu1"}
      output: 'ok '
      stage: delete package.
    - input: >-
        agent 001 dbsync packages DELETED {"checksum":"1c1bf8bbc20caef77010f960461cc20fb9c67568",
        "architecture":"amd64","description":"Qt 5 OpenGL module","format":"deb","groups":"libs",
        "item_id":"caa4868d177fbebc5b145a2a92497ebcf566838a","multiarch":"same","name":"libqt5opengl5",
        "priority":"optional","scan_time":"2021/10/13 15:10:49","size":572,"source":"qtbase-opensource-src",
        "vendor":"Ubuntu Developers <ubuntu-devel-discuss@lists.ubuntu.com>","version":"5.12.8+dfsg-0ubuntu1"}
      output: 'ok '
      stage: delete already deleted package.

- name: "Syscollector deltas messages - osinfo"
  description: Test successfull and err while dealing with osinfo deltas
  configuration_parameters:
  metadata:
    test_case:
    - input: >-
        agent 001 dbsync osinfo INSERTED {"checksum":"1634140017886803554","architecture":"x86_64","hostname":"UBUNTU",
        "os_major":"6","os_minor":"1","os_name":"Microsoft Windows 7","os_release":"sp1","os_version":"6.1.7601",
        "os_build":"7601","os_display_version":"test"}
      output: 'ok '
      stage: insert osinfo.
    - input: >-
        agent 001 dbsync osinfo INSERTED {"checksum":"1634140017886803554","architecture":"x86_64","hostname":"UBUNTU",
        "os_build":"7601","os_major":"6","os_minor":"1","os_release":"sp1","os_version":"6.1.7601",
        "os_display_version":"test"}
      output: 'ok '
      stage: insert osinfo without enough fields.
    - input: >-
        agent 001 dbsync osinfo INSERTED {"checksum":"1634140017886803554","architecture":"x86_64","hostname":"UBUNTU",
        "os_major":"6","os_minor":"1","os_name":["Microsoft Windows 7"],"os_release":"sp1","os_version":"6.1.7601",
        "os_build":"7601","os_display_version":"test"}
      output: err
      stage: insert osinfo with invalid field type.
    - input: >-
        agent 001 dbsync osinfo MODIFIED {"checksum":"1634140017886803570","architecture":"x86_64","hostname":"UBUNTU",
        "os_major":"6","os_minor":"1","os_name":"Microsoft Windows 7","os_release":"sp1","os_version":"6.1.7601",
        "os_build":"7601","os_display_version":"test"}
      output: 'ok '
      stage: modify osinfo.
    - input: >-
        agent 001 dbsync osinfo MODIFIED {"checksum":"1634140017886803554","architecture":"x86_64","hostname":"UBUNTU",
        "os_build":"7601","os_major":"6","os_minor":"1","os_release":"sp1","os_version":"6.1.7601",
        "os_display_version":"test"}
      output: 'ok '
      stage: modify osinfo without enough fields.
    - input: >-
        agent 001 dbsync osinfo MODIFIED {"checksum":"1634140017886803570","architecture":"x86_64","hostname":"UBUNTU",
        "os_major":"6","os_minor":"1","os_name":"Microsoft Windows 7","os_release":"sp1","os_version":"6.1.7601",
        "os_build":"7601","os_display_version":"test"}
      output: 'ok '
      stage: modify nonexistent osinfo.
    - input: >-
        agent 001 dbsync osinfo MODIFIED {"checksum":"1634140017886803570","architecture":"x86_64","hostname":"UBUNTU",
        "os_major":"6","os_minor":"1","os_name":["Microsoft Windows 7"],"os_release":"sp1","os_version":"6.1.7601",
        "os_build":"7601","os_display_version":"test"}
      output: err
      stage: modify osinfo with invalid field type.
    - input: >-
        agent 001 dbsync osinfo DELETED {"checksum":"1634140017886803570","architecture":"x86_64","hostname":"UBUNTU",
        "os_major":"6","os_minor":"1","os_name":"Microsoft Windows 7","os_release":"sp1","os_version":"6.1.7601",
        "os_build":"7601","os_display_version":"test"}
      output: err
      ignore: 'yes'
      stage: delete osinfo without enough fields.
    - input: >-
        agent 001 dbsync osinfo DELETED {"checksum":"1634140017886803570","architecture":"x86_64","hostname":"UBUNTU",
        "os_major":"6","os_minor":"1","os_name":"Microsoft Windows 7","os_release":"sp1","os_version":"6.1.7601",
        "os_build":"7601","os_display_version":"test"}
      output: err
      ignore: 'yes'
      stage: delete osinfo.

- name: "Syscollector deltas messages - hwinfo"
  description: Test successfull and err while dealing with hwinfo deltas
  configuration_parameters:
  metadata:
    test_case:
    - input: >-
        agent 001 dbsync hwinfo INSERTED {"scan_time":"2021/10/13 14:41:43","board_serial":"Intel Corporation",
        "checksum":"af7b22eef8f5e06c04af4db49c9f8d1d28963918","cpu_MHz":2904,"cpu_cores":2,
        "cpu_name":"Intel(R) Core(TM) i5-9400 CPU @ 2.90GHz","ram_free":2257872,"ram_total":4972208,"ram_usage":54}
      output: 'ok '
      stage: insert hwinfo.
    - input: >-
        agent 001 dbsync hwinfo INSERTED {"scan_time":"2021/10/13 14:41:43",
        "checksum":"af7b22eef8f5e06c04af4db49c9f8d1d28963918","cpu_MHz":2904,"cpu_cores":2,
        "cpu_name":"Intel(R) Core(TM) i5-9400 CPU @ 2.90GHz","ram_free":2257872,"ram_total":4972208,"ram_usage":54}
      output: 'ok '
      stage: insert hwinfo without enough fields.
    - input: >-
        agent 001 dbsync hwinfo INSERTED {"scan_time":"2021/10/13 14:41:43","board_serial":"Intel Corporation",
        "checksum":"af7b22eef8f5e06c04af4db49c9f8d1d28963918","cpu_MHz":2904Hz,"cpu_cores":2,
        "cpu_name":"Intel(R) Core(TM) i5-9400 CPU @ 2.90GHz","ram_free":2257872,"ram_total":4972208,"ram_usage":54}
      output: err
      stage: insert hwinfo with invalid field type.
    - input: >-
        agent 001 dbsync hwinfo MODIFIED {"scan_time":"2021/10/13 14:41:43","board_serial":"Intel Corporation",
        "checksum":"af7b22eef8f5e06c04af4db49c9f8d1d28963918","cpu_MHz":2904,"cpu_cores":2,
        "cpu_name":"Intel(R) Core(TM) i5-9400 CPU @ 2.90GHz","ram_free":225,"ram_total":4972208,"ram_usage":54}
      output: 'ok '
      stage: modify hwinfo.
    - input: >-
        agent 001 dbsync hwinfo MODIFIED {"scan_time":"2021/10/13 14:41:43",
        "checksum":"af7b22eef8f5e06c04af4db49c9f8d1d28963918","cpu_MHz":29040,"cpu_cores":2,
        "cpu_name":"Intel(R) Core(TM) i5-9400 CPU @ 2.90GHz","ram_free":225,"ram_total":4972208,"ram_usage":54}
      output: 'ok '
      stage: modify hwinfo without enough fields.
    - input: >-
        agent 001 dbsync hwinfo MODIFIED {"scan_time":"2021/10/13 14:41:43","board_serial":"Intel Corporation",
        "checksum":"af7b22eef8f5e06c04af4db49c9f8d1d28963918","cpu_MHz":2904,"cpu_cores":2,
        "cpu_name":"Intel(R) Core(TM) i5-9400 CPU @ 2.90GHz","ram_free":225mb,"ram_total":49722,"ram_usage":54}
      output: err
      stage: modify hwinfo with invalid field type.
    - input: >-
        agent 001 dbsync hwinfo MODIFIED {"scan_time":"2021/10/13 14:41:43","board_serial":"AMD",
        "checksum":"af7b22eef8f5e06c04af4db49c9f8d1d28963918","cpu_MHz":2904,"cpu_cores":2,
        "cpu_name":"Intel(R) Core(TM) i5-9400 CPU @ 2.90GHz","ram_free":225,"ram_total":4972208,"ram_usage":54}
      output: 'ok '
      stage: modify nonexistent hwinfo.
    - input: >-
        agent 001 dbsync hwinfo DELETED {"scan_time":"2021/10/13 14:41:43",
        "checksum":"af7b22eef8f5e06c04af4db49c9f8d1d28963918","cpu_MHz":2904,"cpu_cores":2,
        "cpu_name":"Intel(R) Core(TM) i5-9400 CPU @ 2.90GHz","ram_free":225,"ram_total":4972208,"ram_usage":54}
      output: err
      ignore: 'yes'
      stage: delete hwinfo without enough fields.
    - input: >-
        agent 001 dbsync hwinfo DELETED {"scan_time":"2021/10/13 14:41:43","board_serial":"Intel Corporation",
        "checksum":"af7b22eef8f5e06c04af4db49c9f8d1d28963918","cpu_MHz":2904,"cpu_cores":2,
        "cpu_name":"Intel(R) Core(TM) i5-9400 CPU @ 2.90GHz","ram_free":225,"ram_total":4972208,"ram_usage":54}
      output: err
      ignore: 'yes'
      stage: delete hwinfo.

- name: "Syscollector deltas messages - hotfixes"
  description: Test successfull and err while dealing with hotfixes deltas
  configuration_parameters:
  metadata:
    test_case:
    - input: >-
        agent 001 dbsync hotfixes INSERTED {"checksum":"ded25e55c93121675adcb8d429dc586cbb351e3a","hotfix":"KB5005539",
        "scan_time":"2021/10/14 02:24:18"}
      output: 'ok '
      stage: insert hotfix.
    - input: >-
        agent 001 dbsync hotfixes INSERTED {"checksum":"ded25e55c93121675adcb8d429dc586cbb351e3a",
        "scan_time":"2021/10/14 02:24:18"}
      output: 'ok '
      stage: insert hotfix without enough fields.
    - input: >-
        agent 001 dbsync hotfixes INSERTED {"checksum":"ded25e55c93121675adcb8d429dc586cbb351e3a","hotfix":"KB5005539",
        "scan_time":"2021/10/14 02:24:18"}
      output: 'ok '
      stage: insert duplicated hotfix.
    - input: >-
        agent 001 dbsync hotfixes INSERTED {"checksum":"ded25e55c93121675adcb8d429dc586cbb351e3a","hotfix":"KB5005539",
        "scan_time":["2021/10/14 02:24:18"]}
      output: err
      stage: insert hotfix with invalid field type.
    - input: >-
        agent 001 dbsync hotfixes MODIFIED {"checksum":"ded25e55c93121675adcb8d429dc586cbb351e3a","hotfix":"KB5005539",
        "scan_time":"2021/10/14 02:24:40"}
      output: 'ok '
      stage: modify hotfix.
    - input: >-
        agent 001 dbsync hotfixes MODIFIED {"checksum":"ded25e55c93121675adcb8d429dc586cbb351e3a",
        "scan_time":"2021/10/14 02:24:40"}
      output: 'ok '
      stage: modify hotfix without enough fields.
    - input: >-
        agent 001 dbsync hotfixes MODIFIED {"checksum":"ded25e55c93121675adcb8d429dc586cbb351e3a","hotfix":"KB5005123",
        "scan_time":"2021/10/14 02:24:40"}
      output: 'ok '
      stage: modify nonexistent hotfix.
    - input: >-
        agent 001 dbsync hotfixes DELETED {"checksum":"ded25e55c93121675adcb8d429dc586cbb351e3a",
        "scan_time":"2021/10/14 02:24:40"}
      output: 'ok '
      stage: delete hotfix without enough fields.
    - input: >-
        agent 001 dbsync hotfixes MODIFIED {"checksum":"ded25e55c93121675adcb8d429dc586cbb351e3a","hotfix":"KB5005123",
        "scan_time":"2021/10/14 02:24:40"}
      output: 'ok '
      stage: delete hotfix.
    - input: >-
        agent 001 dbsync hotfixes MODIFIED {"checksum":"ded25e55c93121675adcb8d429dc586cbb351e3a","hotfix":"KB5005123",
        "scan_time":"2021/10/14 02:24:40"}
      output: 'ok '
      stage: delete already deleted hotfix.

- name: "FIM messages - Basics success"
  description: "Check success use cases (save2, load and delete)"
  configuration_parameters:
  metadata:
    test_case:
    - input: "agent 001 syscheck save2 {\"path\":\"/home/test/file2\",\"timestamp\":1575421292,\"attributes\":{\"type\":\"file\",\"size\":0,\"perm\":\"rw-r--r--\",\"uid\":\"0\",\"gid\":\"0\",\"user_name\":\"root\",\"group_name\":\"root\",\"inode\":16879,\"mtime\":1575421292,\"hash_md5\":\"d41d8cd98f00b204e9800998ecf8427e\",\"hash_sha1\":\"da39a3ee5e6b4b0d3255bfef95601890afd80709\",\"hash_sha256\":\"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855\",\"checksum\":\"f65b9f66c5ef257a7566b98e862732640d502b6f\"}}"
      output: "ok"
      stage: "Syscheck save2 success"
    - input: "agent 001 syscheck load /home/test/file2"
      output: "ok 0:rw-r--r--:0:0:d41d8cd98f00b204e9800998ecf8427e:da39a3ee5e6b4b0d3255bfef95601890afd80709:root:root:1575421292:16879:e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855:!1:1575421292"
      stage: "Syscheck save2 load success"
    - input: "agent 001 syscheck load /home/test/file"
      output: "ok "
      stage: "Syscheck load success"
    - input: "agent 001 syscheck delete /home/test/file2"
      output: "ok"
      stage: "Syscheck delete success"
    - input: "agent 001 syscheck load /home/test/file2"
      output: "ok "
      stage: "Syscheck delete load success"

- name: "FIM messages - Syntax errors"
  description: "Invalid syntax errors (save2, load and delete)"
  configuration_parameters:
  metadata:
    test_case:
    - input: "agent 002 syscheck delete"
      output: "err Invalid FIM query syntax, near 'delete'"
      stage: "Syscheck delete invalid syntax"
    - input: "agent 002 syscheck save2"
      output: "err Invalid FIM query syntax, near 'save2'"
      stage: "Syscheck save2 invalid syntax"
    - input: "agent 002 syscheck load"
      output: "err Invalid FIM query syntax, near 'load'"
      stage: "Syscheck load invalid syntax"
    - input: "agent 001 syscheck integrity_check_global"
      output: "err Invalid FIM query syntax, near 'integrity_check_global'"
      stage: "Syscheck integrity_check_global fail - invalid syntax"
    - input: "agent 001 syscheck integrity_check_left"
      output: "err Invalid FIM query syntax, near 'integrity_check_left'"
      stage: "Syscheck integrity_check_left fail - invalid syntax"
    - input: "agent 001 syscheck integrity_clear"
      output: "err Invalid FIM query syntax, near 'integrity_clear'"
      stage: "Syscheck integrity_clear fail - invalid syntax"

- name: "FIM messages - Save2 fails"
  description: "Check save2 fail use cases"
  configuration_parameters:
  metadata:
    test_case:
    - input: "agent 002 syscheck save2 {\"path\":\"/home/test/file2\"\"timestamp\":1575421292,\"attributes\":{\"type\":\"file\",\"size\":0,\"perm\":\"rw-r--r--\",\"uid\":\"0\",\"gid\":\"0\",\"user_name\":\"root\",\"group_name\":\"root\",\"inode\":16879,\"mtime\":1575421292,\"hash_md5\":\"d41d8cd98f00b204e9800998ecf8427e\",\"hash_sha1\":\"da39a3ee5e6b4b0d3255bfef95601890afd80709\",\"hash_sha256\":\"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855\",\"checksum\":\"f65b9f66c5ef257a7566b98e862732640d502b6f\"}}"
      output: "err Cannot save Syscheck"
      stage: "Syscheck save2 fail: Bad JSON"
    - input: "agent 002 syscheck save2 {\"timestamp\":1575421292,\"attributes\":{\"type\":\"file\",\"size\":0,\"perm\":\"rw-r--r--\",\"uid\":\"0\",\"gid\":\"0\",\"user_name\":\"root\",\"group_name\":\"root\",\"inode\":16879,\"mtime\":1575421292,\"hash_md5\":\"d41d8cd98f00b204e9800998ecf8427e\",\"hash_sha1\":\"da39a3ee5e6b4b0d3255bfef95601890afd80709\",\"hash_sha256\":\"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855\",\"checksum\":\"f65b9f66c5ef257a7566b98e862732640d502b6f\"}}"
      output: "err Cannot save Syscheck"
      stage: "Syscheck save2 fail: no path"
    - input: "agent 002 syscheck save2 {\"path\":\"/home/test/file2\",\"timestamp\":\"asdf\",\"attributes\":{\"type\":\"file\",\"size\":0,\"perm\":\"rw-r--r--\",\"uid\":\"0\",\"gid\":\"0\",\"user_name\":\"root\",\"group_name\":\"root\",\"inode\":16879,\"mtime\":1575421292,\"hash_md5\":\"d41d8cd98f00b204e9800998ecf8427e\",\"hash_sha1\":\"da39a3ee5e6b4b0d3255bfef95601890afd80709\",\"hash_sha256\":\"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855\",\"checksum\":\"f65b9f66c5ef257a7566b98e862732640d502b6f\"}}"
      output: "err Cannot save Syscheck"
      stage: "Syscheck save2 fail: Bad (or no) timestamp"
    - input: "agent 001 syscheck save2 {\"path\":\"/home/test/file2\",\"timestamp\":1575421292}"
      output: "err Cannot save Syscheck"
      stage: "Syscheck save2 fail: No attributes"
    - input: "agent 001 syscheck save2 {\"path\":\"/home/test/file2\",\"timestamp\":1575421292,\"attributes\":{\"\":\"file\",\"size\":0,\"perm\":\"rw-r--r--\",\"uid\":\"0\",\"gid\":\"0\",\"user_name\":\"root\",\"group_name\":\"root\",\"inode\":16879,\"mtime\":1575421292,\"hash_md5\":\"d41d8cd98f00b204e9800998ecf8427e\",\"hash_sha1\":\"da39a3ee5e6b4b0d3255bfef95601890afd80709\",\"hash_sha256\":\"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855\",\"checksum\":\"f65b9f66c5ef257a7566b98e862732640d502b6f\"}}"
      output: "err Cannot save Syscheck"
      stage: "Syscheck save2 fail: Null attribute field (sqlite3_step fail)"
    - input: "agent 001 syscheck save2 {\"path\":\"/home/test/file2\",\"timestamp\":1575421292,\"attributes\":{\"file\":null,\"size\":0,\"perm\":\"rw-r--r--\",\"uid\":\"0\",\"gid\":\"0\",\"user_name\":\"root\",\"group_name\":\"root\",\"inode\":16879,\"mtime\":1575421292,\"hash_md5\":\"d41d8cd98f00b204e9800998ecf8427e\",\"hash_sha1\":\"da39a3ee5e6b4b0d3255bfef95601890afd80709\",\"hash_sha256\":\"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855\",\"checksum\":\"f65b9f66c5ef257a7566b98e862732640d502b6f\"}}"
      output: "err Cannot save Syscheck"
      stage: "Syscheck save2 fail: Null attribute value (sqlite3_step fail and reset)"
    - input: "agent 001 syscheck save2 {\"path\":\"/home/test/file2\",\"timestamp\":1575421292,\"attributes\":{\"unknown_field\":\"unknown_value\",\"type\":\"file\",\"size\":0,\"perm\":\"rw-r--r--\",\"uid\":\"0\",\"gid\":\"0\",\"user_name\":\"root\",\"group_name\":\"root\",\"inode\":16879,\"mtime\":1575421292,\"hash_md5\":\"d41d8cd98f00b204e9800998ecf8427e\",\"hash_sha1\":\"da39a3ee5e6b4b0d3255bfef95601890afd80709\",\"hash_sha256\":\"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855\",\"checksum\":\"f65b9f66c5ef257a7566b98e862732640d502b6f\"}}"
      output: "err Cannot save Syscheck"
      stage: "Syscheck save2 fail: Unknown attribute field"

- name: "FIM messages - Integrity_check_global success"
  description: "Integrity_check_global success"
  configuration_parameters:
  metadata:
    test_case:
    - input: "agent 001 syscheck save2 {\"path\":\"/home/test/file1\",\"timestamp\":1575421292,\"attributes\":{\"type\":\"file\",\"size\":0,\"perm\":\"rw-r--r--\",\"uid\":\"0\",\"gid\":\"0\",\"user_name\":\"root\",\"group_name\":\"root\",\"inode\":16879,\"mtime\":1575421292,\"hash_md5\":\"d41d8cd98f00b204e9800998ecf8427e\",\"hash_sha1\":\"da39a3ee5e6b4b0d3255bfef95601890afd80709\",\"hash_sha256\":\"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855\",\"checksum\":\"f65b9f66c5ef257a7566b98e862732640d502b6f\"}}"
      output: "ok"
      stage: "Syscheck integrity_check_global preparation file1"
    - input: "agent 001 syscheck save2 {\"path\":\"/home/test/file2\",\"timestamp\":1575421292,\"attributes\":{\"type\":\"file\",\"size\":0,\"perm\":\"rw-r--r--\",\"uid\":\"0\",\"gid\":\"0\",\"user_name\":\"root\",\"group_name\":\"root\",\"inode\":16879,\"mtime\":1575421292,\"hash_md5\":\"d41d8cd98f00b204e9800998ecf8427e\",\"hash_sha1\":\"da39a3ee5e6b4b0d3255bfef95601890afd80709\",\"hash_sha256\":\"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855\",\"checksum\":\"f65b9f66c5ef257a7566b98e862732640d502b6f\"}}"
      output: "ok"
      stage: "Syscheck integrity_check_global preparation file2"
    - input: "agent 001 syscheck integrity_check_global {\"begin\":\"/home/test/file1\",\"end\":\"/home/test/file2\",\"checksum\":\"2a41be94762b4dc57d98e8262e85f0b90917d6be\",\"id\":1}"
      output: "ok "
      stage: "Syscheck integrity_check_global success"
    - input: "agent 001 syscheck integrity_check_global {\"begin\":\"/home/test/file1\",\"end\":\"/home/test/file2\",\"checksum\":\"asdf1234\",\"id\":1}"
      output: "ok checksum_fail"
      stage: "Syscheck integrity_check_global fail - checksum_fail"
    - input: "agent 001 syscheck integrity_check_global {\"begin\":\"/home/test/f1\",\"end\":\"/home/test/f2\",\"checksum\":\"1234\",\"id\":1}"
      output: "ok no_data"
      stage: "Syscheck integrity_check_global success - no data"
    - input: "agent 001 syscheck load /home/test/f1"
      output: "ok "
      stage: "Syscheck Integrity_check_global load success"
    - input: "agent 001 syscheck integrity_check_global {\"begin\":\"/home/test/file1\",\"end\":\"/home/test/file2\",\"checksum\":\"2a41be94762b4dc57d98e8262e85f0b90917d6be\",\"id\":1}"
      output: "ok no_data"
      stage: "Syscheck integrity_check_global success - no data"

- name: "FIM messages - Integrity_check_global fails"
  description: "Integrity_check_global fails"
  configuration_parameters:
  metadata:
    test_case:
    - input: "agent 001 syscheck integrity_check_global "
      output: "err Cannot perform range checksum"
      stage: "Syscheck integrity_check_global fail - no payload"
    - input: "agent 001 syscheck integrity_check_global {\"end\":\"/home/test/f2\",\"checksum\":\"1234\",\"id\":1}"
      output: "err Cannot perform range checksum"
      stage: "Syscheck integrity_check_global - no 'begin' field"
    - input: "agent 001 syscheck integrity_check_global {\"begin\":\"/home/test/f1\",\"checksum\":\"1234\",\"id\":1}"
      output: "err Cannot perform range checksum"
      stage: "Syscheck integrity_check_global - no 'end' field"
    - input: "agent 001 syscheck integrity_check_global {\"begin\":\"/home/test/f1\",\"end\":\"/home/test/f2\",\"id\":1}"
      output: "err Cannot perform range checksum"
      stage: "Syscheck integrity_check_global - no 'checksum' field"
    - input: "agent 001 syscheck integrity_check_global {\"begin\":\"/home/test/f1\",\"end\":\"/home/test/f2\",\"checksum\":\"1234\"}"
      output: "err Cannot perform range checksum"
      stage: "Syscheck integrity_check_global - no 'id' field"

- name: "FIM messages - Integrity_check_left success"
  description: "Integrity_check_left success"
  configuration_parameters:
  metadata:
    test_case:
    - input: "agent 001 syscheck save2 {\"path\":\"/home/test/file1\",\"timestamp\":1575421292,\"attributes\":{\"type\":\"file\",\"size\":0,\"perm\":\"rw-r--r--\",\"uid\":\"0\",\"gid\":\"0\",\"user_name\":\"root\",\"group_name\":\"root\",\"inode\":16879,\"mtime\":1575421292,\"hash_md5\":\"d41d8cd98f00b204e9800998ecf8427e\",\"hash_sha1\":\"da39a3ee5e6b4b0d3255bfef95601890afd80709\",\"hash_sha256\":\"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855\",\"checksum\":\"f65b9f66c5ef257a7566b98e862732640d502b6f\"}}"
      output: "ok"
      stage: "Syscheck integrity_check_left preparation file1"
    - input: "agent 001 syscheck save2 {\"path\":\"/home/test/file2\",\"timestamp\":1575421292,\"attributes\":{\"type\":\"file\",\"size\":0,\"perm\":\"rw-r--r--\",\"uid\":\"0\",\"gid\":\"0\",\"user_name\":\"root\",\"group_name\":\"root\",\"inode\":16879,\"mtime\":1575421292,\"hash_md5\":\"d41d8cd98f00b204e9800998ecf8427e\",\"hash_sha1\":\"da39a3ee5e6b4b0d3255bfef95601890afd80709\",\"hash_sha256\":\"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855\",\"checksum\":\"f65b9f66c5ef257a7566b98e862732640d502b6f\"}}"
      output: "ok"
      stage: "Syscheck integrity_check_left preparation file2"
    - input: "agent 001 syscheck integrity_check_left {\"begin\":\"/home/test/file1\",\"end\":\"/home/test/file2\",\"checksum\":\"2a41be94762b4dc57d98e8262e85f0b90917d6be\",\"id\":1}"
      output: "ok "
      stage: "Syscheck integrity_check_left success - no tail"
    - input: "agent 001 syscheck integrity_check_left {\"begin\":\"/home/test/file1\",\"end\":\"/home/test/file2\",\"checksum\":\"2a41be94762b4dc57d98e8262e85f0b90917d6be\",\"id\":1,\"tail\":3}"
      output: "ok "
      stage: "Syscheck integrity_check_left success - tail"
    - input: "agent 001 syscheck integrity_check_left {\"begin\":\"/home/test/file1\",\"end\":\"/home/test/file2\",\"checksum\":\"asdf1234\",\"id\":1}"
      output: "ok checksum_fail"
      stage: "Syscheck integrity_check_left fail - checksum_fail"
    - input: "agent 001 syscheck integrity_check_left {\"begin\":\"/home/test/f1\",\"end\":\"/home/test/f2\",\"checksum\":\"1234\",\"id\":1}"
      output: "ok no_data"
      stage: "Syscheck integrity_check_left success - no data"

- name: "FIM messages - Integrity_check_left fails"
  description: "Integrity_check_left fails"
  configuration_parameters:
  metadata:
    test_case:
    - input: "agent 001 syscheck integrity_check_left "
      output: "err Cannot perform range checksum"
      stage: "Syscheck integrity_check_left fail - no payload"
    - input: "agent 001 syscheck integrity_check_left {\"end\":\"/home/test/f2\",\"checksum\":\"1234\",\"id\":1}"
      output: "err Cannot perform range checksum"
      stage: "Syscheck integrity_check_left - no 'begin' field"
    - input: "agent 001 syscheck integrity_check_left {\"begin\":\"/home/test/f1\",\"checksum\":\"1234\",\"id\":1}"
      output: "err Cannot perform range checksum"
      stage: "Syscheck integrity_check_left - no 'end' field"
    - input: "agent 001 syscheck integrity_check_left {\"begin\":\"/home/test/f1\",\"end\":\"/home/test/f2\",\"id\":1}"
      output: "err Cannot perform range checksum"
      stage: "Syscheck integrity_check_left - no 'checksum' field"
    - input: "agent 001 syscheck integrity_check_left {\"begin\":\"/home/test/f1\",\"end\":\"/home/test/f2\",\"checksum\":\"1234\"}"
      output: "err Cannot perform range checksum"
      stage: "Syscheck integrity_check_left - no 'id' field"

- name: "FIM messages - Integrity clear success"
  description: "Integrity_check_left fails"
  configuration_parameters:
  metadata:
    test_case:
    - input: "agent 001 syscheck integrity_clear {\"id\":1}"
      output: "ok "
      stage: "Syscheck integrity_clear success"

- name: "FIM messages - Integrity_clear fails"
  description: "Integrity_clear fails"
  configuration_parameters:
  metadata:
    test_case:
    - input: "agent 001 syscheck integrity_clear "
      output: "err Cannot perform range checksum"
      stage: "Syscheck integrity_clear fail - no payload"
    - input: "agent 001 syscheck integrity_clear {}"
      output: "err Cannot perform range checksum"
      stage: "Syscheck integrity_clear fail - no id"

- name: "FIM messages - Invalid agent ID"
  description: "The syntax for every query for Wazuh DB is agent {ID} {component} {query}. This section covers the dealing with unexpected values of the agent ID."
  configuration_parameters:
  metadata:
    test_case:
    - input: "agent fake_id syscheck integrity_clear {\"id\":1}"
      output: "err Invalid agent ID 'fake_id'"
      stage: "Syscheck - Invalid agent ID"
    - input: "agent syscheck integrity_clear {\"id\":1}"
      output: "err Invalid agent ID 'syscheck'"
      stage: "Syscheck - Missing agent ID (one space)"
    - input: "agent  syscheck integrity_clear {\"id\":1}"
      output: "ok "
      stage: "Syscheck - Missing agent ID (two spaces)"
    - input: "agent   syscheck integrity_clear {\"id\":1}"
      output: "err Invalid DB query syntax, near ''"
      stage: "Syscheck - Missing agent ID (three spaces)"
    - input: "agent 1 syscheck integrity_clear {\"id\":1}"
      output: "ok "
      stage: "Syscheck - Less than three digits for the agent ID"

- name: "FIM messages - Update existing file"
  description: "Update attributes for an existing file"
  configuration_parameters:
  metadata:
    test_case:
    - input: "agent 001 syscheck save2 {\"path\":\"/home/test/file\",\"timestamp\":1575421292,\"attributes\":{\"type\":\"file\",\"size\":0,\"perm\":\"rw-r--r--\",\"uid\":\"0\",\"gid\":\"0\",\"user_name\":\"root\",\"group_name\":\"root\",\"inode\":16879,\"mtime\":1575421292,\"hash_md5\":\"d41d8cd98f00b204e9800998ecf8427e\",\"hash_sha1\":\"da39a3ee5e6b4b0d3255bfef95601890afd80709\",\"hash_sha256\":\"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855\",\"checksum\":\"f65b9f66c5ef257a7566b98e862732640d502b6f\"}}"
      output: "ok"
      stage: "Syscheck save2 success"
    - input: "agent 001 syscheck load /home/test/file"
      output: "ok 0:rw-r--r--:0:0:d41d8cd98f00b204e9800998ecf8427e:da39a3ee5e6b4b0d3255bfef95601890afd80709:root:root:1575421292:16879:e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855:!1:1575421292"
      stage: "Syscheck save2 load success"
    - input: "agent 001 syscheck save2 {\"path\":\"/home/test/file\",\"timestamp\":1575420000,\"attributes\":{\"type\":\"file\",\"size\":100,\"perm\":\"rw-rw-rw-\",\"uid\":\"1\",\"gid\":\"1\",\"user_name\":\"toor\",\"group_name\":\"toor\",\"inode\":16880,\"mtime\":1570001295,\"hash_md5\":\"d41d8cd98f00b204e9800998ecf842ff\",\"hash_sha1\":\"da39a3ee5e6b4b0d3255bfef95601890afd80799\",\"hash_sha256\":\"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b800\",\"checksum\":\"f65b9f66c5ef257a7566b98e862732640d502b7f\"}}"
      output: "ok"
      stage: "Syscheck save2 success"
    - input: "agent 001 syscheck load /home/test/file"
      output: "ok 100:rw-rw-rw-:1:1:d41d8cd98f00b204e9800998ecf842ff:da39a3ee5e6b4b0d3255bfef95601890afd80799:toor:toor:1570001295:16880:e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b800:!1:1575420000"
      stage: "Syscheck save2 load success"

- name: "FIM messages - Path length"
  description: "Check how Wazuh DB deals with path larger than the maximum size (4096)."
  configuration_parameters:
  metadata:
    test_case:
    - input: "agent 001 syscheck save2 {\"path\":\"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\",\"timestamp\":1575421292,\"attributes\":{\"type\":\"file\",\"size\":0,\"perm\":\"rw-r--r--\",\"uid\":\"0\",\"gid\":\"0\",\"user_name\":\"root\",\"group_name\":\"root\",\"inode\":16879,\"mtime\":1575421292,\"hash_md5\":\"d41d8cd98f00b204e9800998ecf8427e\",\"hash_sha1\":\"da39a3ee5e6b4b0d3255bfef95601890afd80709\",\"hash_sha256\":\"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855\",\"checksum\":\"f65b9f66c5ef257a7566b98e862732640d502b6f\"}}"
      output: "ok"
      stage: "Syscheck save2 success"
    - input: "agent 001 syscheck load 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"
      output: "ok 0:rw-r--r--:0:0:d41d8cd98f00b204e9800998ecf8427e:da39a3ee5e6b4b0d3255bfef95601890afd80709:root:root:1575421292:16879:e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855:!1:1575421292"
      stage: "Syscheck save2 load success"

- name: "FIM messages - Checksum field"
  description: "Insert a file entry without the checksum field or with NULL in it"
  configuration_parameters:
  metadata:
    test_case:
    - input: "agent 001 syscheck save2 {\"path\":\"/home/test/file\",\"timestamp\":1575421292,\"attributes\":{\"type\":\"file\",\"size\":0,\"perm\":\"rw-r--r--\",\"uid\":\"0\",\"gid\":\"0\",\"user_name\":\"root\",\"group_name\":\"root\",\"inode\":16879,\"mtime\":1575421292,\"hash_md5\":\"d41d8cd98f00b204e9800998ecf8427e\",\"hash_sha1\":\"da39a3ee5e6b4b0d3255bfef95601890afd80709\",\"hash_sha256\":\"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855\"}}"
      output: "ok"
      stage: "Syscheck save2 success"
    - input: "agent 001 syscheck save2 {\"path\":\"/home/test/file\",\"timestamp\":1575421292,\"attributes\":{\"type\":\"file\",\"size\":0,\"perm\":\"rw-r--r--\",\"uid\":\"0\",\"gid\":\"0\",\"user_name\":\"root\",\"group_name\":\"root\",\"inode\":16879,\"mtime\":1575421292,\"hash_md5\":\"d41d8cd98f00b204e9800998ecf8427e\",\"hash_sha1\":\"da39a3ee5e6b4b0d3255bfef95601890afd80709\",\"hash_sha256\":\"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855\",\"checksum\":\"\"}}"
      output: "ok"
      stage: "Syscheck save2 success"

- name: "FIM messages - Large inode"
  description: "Check that large inode numbers are saved and loaded properly"
  configuration_parameters:
  metadata:
    test_case:
    - input: "agent 001 syscheck save2 {\"path\":\"/home/test/file2\",\"timestamp\":1575421292,\"attributes\":{\"type\":\"file\",\"size\":0,\"perm\":\"rw-r--r--\",\"uid\":\"0\",\"gid\":\"0\",\"user_name\":\"root\",\"group_name\":\"root\",\"inode\":2311061769,\"mtime\":1575421292,\"hash_md5\":\"d41d8cd98f00b204e9800998ecf8427e\",\"hash_sha1\":\"da39a3ee5e6b4b0d3255bfef95601890afd80709\",\"hash_sha256\":\"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855\",\"checksum\":\"f65b9f66c5ef257a7566b98e862732640d502b6f\"}}"
      output: "ok"
      stage: "Syscheck save2 success"
    - input: "agent 001 syscheck load /home/test/file2"
      output: "ok 0:rw-r--r--:0:0:d41d8cd98f00b204e9800998ecf8427e:da39a3ee5e6b4b0d3255bfef95601890afd80709:root:root:1575421292:2311061769:e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855:!1:1575421292"
      stage: "Syscheck save2 load success"

- name: 'Not existing agent'
  description: 'Check messages from not registered agents.'
  configuration_parameters:
  metadata:
    test_case:
    - input: 'agent 004 syscheck delete '
      output: 'err Agent not found'
      stage: 'Syscheck query to a non-existing agent'

- name: "Agent messages - Agents' OS table: sys_osinfo"
  description: "It checks the commands get and set"
  configuration_parameters:
  metadata:
    test_case:
    - input: 'agent 000 sql DELETE FROM sys_osinfo'
      output: "ok []"
      stage: "agent sys_osinfo cleaning sys_osinfo table"
    - input: 'agent 000 osinfo get'
      output: "ok []"
      stage: "agent sys_osinfo checking table is empty"
    - input: 'agent 000 osinfo set 0|2021/04/08 10:00:00|focal|x86_64|Ubuntu|20.04.2 LTS (Focal Fossa)|focal|20|04|1|ubuntu|Linux|5.4.0-70-generic|#78-Ubuntu SMP Thu Apr 08 10:00:00 UTC 2021|1|2|NULL'
      output: 'ok'
      stage: "agent sys_osinfo set information"
    - input: 'agent 000 osinfo get'
      output: 'ok [{"scan_id":0,"scan_time":"2021/04/08 10:00:00","hostname":"focal","architecture":"x86_64","os_name":"Ubuntu","os_version":"20.04.2 LTS (Focal Fossa)","os_codename":"focal","os_major":"20","os_minor":"04","os_patch":"2","os_build":"1","os_platform":"ubuntu","sysname":"Linux","release":"5.4.0-70-generic","version":"#78-Ubuntu SMP Thu Apr 08 10:00:00 UTC 2021","os_release":"1","checksum":"legacy","reference":"54d5344c8f49eae38d81651495227c5080755b45"}]'
      stage: "agent sys_osinfo getting information"
    - input: 'agent 000 sql DELETE FROM sys_osinfo'
      output: "ok []"
      stage: "agent sys_osinfo cleaning sys_osinfo table"
    - input: 'agent 000 osinfo get'
      output: "ok []"
      stage: "agent sys_osinfo checking table is empty"

- name: "Agent messages - Agents' Packages/Hotfixes tables: sys_programs and sys_hotfixes"
  description: "It checks the commands get packages and get hotfixes"
  configuration_parameters:
  metadata:
    test_case:
    - input: 'agent 003 package save 0|2021/04/07 22:00:00|deb|test_deb_pkg|optional|utils|7490|Wazuh wazuh@wazuh.com|NULL|1.0.0|amd64|NULL|NULL|Test package|NULL|1'
      output: 'ok'
      stage: "agent sys_programs adding dummy package"
    - input: 'agent 003 package save 0|2021/04/07 22:00:00|rpm|test_rpm_pkg|optional|utils|7490|Wazuh wazuh@wazuh.com|NULL|1.0.0|amd64|NULL|NULL|Test package|NULL|1'
      output: 'ok'
      stage: "agent sys_programs adding dummy package"
    - input: 'agent 003 sql select count(*) from sys_programs'
      output: 'ok [{"count(*)":2}]'
      stage: "agent sys_programs count packages added"
    - input: 'agent 003 package get'
      output: 'ok {"status":"NOT_SYNCED"}'
      stage: "agent sys_programs getting not synced packages attempt"
    - input: 'agent 003 hotfix save 0|0|KB2980293|legacy'
      output: 'ok'
      stage: "agent sys_hotfixes adding dummy hotfix"
    - input: 'agent 003 hotfix save 0|0|KB2980294|legacy'
      output: 'ok'
      stage: "agent sys_hotfixes adding dummy hotfix"
    - input: 'agent 003 hotfix save 0|0|KB2980295|legacy'
      output: 'ok'
      stage: "agent sys_hotfixes adding dummy hotfix"
    - input: 'agent 003 sql SELECT count(*) FROM sys_hotfixes'
      output: 'ok [{"count(*)":3}]'
      stage: "agent sys_hotfixes count hotfixes added"
    - input: 'agent 003 hotfix get'
      output: 'ok {"status":"NOT_SYNCED"}'
      stage: "agent sys_programs getting not synced packages attempt"
    - input: 'agent 003 sql UPDATE sync_info SET last_attempt = 1, last_completion = 1 where component = "syscollector-hotfixes"'
      output: 'ok []'
      stage: "agent sync_info set synced"
    - input: 'agent 003 hotfix get'
      output: ['due {"hotfix":"KB2980293"}','due {"hotfix":"KB2980294"}','due {"hotfix":"KB2980295"}','ok {"status":"SUCCESS"}']
      stage: "agent sys_hotfixes getting hotfixes"
    - input: 'agent 003 sql UPDATE sync_info SET last_attempt = 1, last_completion = 1 where component = "syscollector-packages"'
      output: 'ok []'
      stage: "agent sync_info set synced"
    - input: 'agent 003 package get'
      output: ['due {"name":"test_deb_pkg","version":"1.0.0","architecture":"amd64","vendor":"Wazuh wazuh@wazuh.com","format":"deb","item_id":"1","description":"Test package","location":"","size":7490}', 'due {"name":"test_rpm_pkg","version":"1.0.0","architecture":"amd64","vendor":"Wazuh wazuh@wazuh.com","format":"rpm","item_id":"1","description":"Test package","location":"","size":7490}', 'ok {"status":"SUCCESS"}']
      stage: "agent sys_programs getting not all packages"

- name: Synchronization value
  description: Check agent db synchronization value
  configuration_parameters:
  metadata:
    test_case:
    - input: agent 003 sql PRAGMA synchronous
      output: ok [{"synchronous":2}]
      stage: agent sync type
      use_regex: "no"
